
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>2. First Examples üî¨ &#8212; openCOSMO-RS Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/7/firstexamples';</script>
    <link rel="canonical" href="/openCOSMO_RS_Book/notebooks/7/firstexamples.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3 Results Analysis üîç" href="ResultsAnalysis.html" />
    <link rel="prev" title="II. openCOSMO-RS" href="github_opencosmors.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="openCOSMO-RS Book - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="openCOSMO-RS Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    ‚öõÔ∏è openCOSMO-RS Guide ‚öõÔ∏è
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../1/opencosmorsintro.html">I. What is COSMO-RS ‚ùì</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../1/conformer%20pipeline.html">1. openCOSMO-RS_conformer_pipeline üìè</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2/Github%20repository.html">2. Program download  üí°</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3/Overview%20conf%20pipe.html">3. Overview of the openCOSMO-RS_conformer_pipeline  üîç</a></li>
<li class="toctree-l2"><a class="reference internal" href="../4/Input%20file.html">4. Let‚Äôs create the input file üß™</a></li>
<li class="toctree-l2"><a class="reference internal" href="../5/Call%20program.html">5. Calling the openCOSMO-RS_conformer_pipeline program! ü§ñ</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../6/Analysis%20input%20file.html">6. Analysis of the Calculations and the Input File üîé</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../6/overview.html">6.1 What is in our input file? üëÄ</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="github_opencosmors.html">II. openCOSMO-RS</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">2. First Examples üî¨</a></li>


<li class="toctree-l2"><a class="reference internal" href="ResultsAnalysis.html">3 Results Analysis üîç</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PriscillaEnsleySolis/openCOSMO_RS_Book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PriscillaEnsleySolis/openCOSMO_RS_Book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/7/firstexamples.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/7/firstexamples.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>2. First Examples üî¨</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2. First Examples üî¨</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-all-necessary-libraries">2.1 Import all necessary libraries  üìö</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-paths-to-our-orcacosmo-files-and-set-the-output-directory">2.2 Define the paths to our .orcacosmo files and set the output directory üìí</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-a-parameterization-and-call-the-model">2.3 Choose a parameterization and call the model ‚öôÔ∏è</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-start-with-the-first-calculations-using-opencosmo">2.4 Let‚Äôs start with the first calculations using openCOSMO üß™</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-calculations">Multiple calculations:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">2.5 Plotting üìà</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sigma-profiles-using-plotly">2.5.1 Sigma profiles using plotly</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#further-examples">2.6 Further examples:</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="first-examples">
<h1>2. First Examples üî¨<a class="headerlink" href="#first-examples" title="Link to this heading">#</a></h1>
<section id="import-all-necessary-libraries">
<h2>2.1 Import all necessary libraries  üìö<a class="headerlink" href="#import-all-necessary-libraries" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#from the cosmo_visualizations code in our src folder</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.cosmo_visualizations</span> <span class="kn">import</span> <span class="n">plot_sigma_profiles</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.cosmo_visualizations</span> <span class="kn">import</span> <span class="n">plot_3D_segment_location</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.cosmo_visualizations</span> <span class="kn">import</span> <span class="n">plot_extended_sigma_profile_plotly</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.cosmo_visualizations</span> <span class="kn">import</span> <span class="n">plot_sigma_profiles_plotly</span>

<span class="c1">#from the cosmors code in our src folder</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.cosmors</span> <span class="kn">import</span> <span class="n">COSMORS</span> 

<span class="c1">#from the input_parsers code in our src folder</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.input_parsers</span> <span class="kn">import</span> <span class="n">SigmaProfileParser</span>

<span class="c1">#from the parameterization code in our src folder</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.parameterization</span> <span class="kn">import</span> <span class="n">Parameterization</span>
<span class="kn">from</span> <span class="nn">opencosmorspy.parameterization</span> <span class="kn">import</span> <span class="n">openCOSMORS24a</span>

<span class="c1">#other libraries:</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">scipy.constants</span> <span class="k">as</span> <span class="nn">spcon</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">kaleido</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
<span class="n">periodic_table</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">GetPeriodicTable</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">constants</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-paths-to-our-orcacosmo-files-and-set-the-output-directory">
<h2>2.2 Define the paths to our .orcacosmo files and set the output directory üìí<a class="headerlink" href="#define-the-paths-to-our-orcacosmo-files-and-set-the-output-directory" title="Link to this heading">#</a></h2>
<p>We are going to be using the <span style="color:#1E90FF;">water.inp</span> file as well as <span style="color:#FF8C00;">butane.inp</span> file. Run the section where we created the input files but now change the file name to <strong>two_molecules.inp</strong>. <br>
Aftwards you should see two more folders: pentane and butane.</p>
<p><strong>Remember</strong> that for every line that you have the following symbols: ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è you need to specify the correct address in your computer</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s now create the folder where we are going to save all of our results</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;Results_openCOSMO&quot;</span>
<span class="c1">#then create the folder where our files are gonna be, for this line to work we need to make sure that the folder does not exist!</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileExistsError</span><span class="g g-Whitespace">                           </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">output_dir</span> <span class="o">=</span> <span class="s2">&quot;Results_openCOSMO&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">#then create the folder where our files are gonna be, for this line to work we need to make sure that the folder does not exist!</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

<span class="nn">File &lt;frozen os&gt;:225,</span> in <span class="ni">makedirs</span><span class="nt">(name, mode, exist_ok)</span>

<span class="ne">FileExistsError</span>: [WinError 183] Cannot create a file when that file already exists: &#39;Results_openCOSMO&#39;
</pre></div>
</div>
</div>
</div>
<p>Add the input files of our molecules</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#input files‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è</span>
<span class="n">water_input</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;orcacosmo_files\water_c000.orcacosmo&quot;</span>
<span class="n">butane_input</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;orcacosmo_files\butane_c000.orcacosmo&quot;</span>
<span class="n">pentane_input</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;orcacosmo_files\pentane_c000.orcacosmo&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="choose-a-parameterization-and-call-the-model">
<h2>2.3 Choose a parameterization and call the model ‚öôÔ∏è<a class="headerlink" href="#choose-a-parameterization-and-call-the-model" title="Link to this heading">#</a></h2>
<p>You can choose between <strong>default_turbomole</strong> or <strong>default_orca</strong>. This refers to the computational chemistry software packages Turbomole and ORCA.</p>
<ul class="simple">
<li><p>Turbomole: it is designed for parallel computing, (type of computation where many calculations or processes are carried out simultaneously) making it suitable for high performance computing systems.</p></li>
<li><p>ORCA: it achieves a good balance between accuracy and computational cost, with efficient algorithms for both small and large systems.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize parameterization for ORCA</span>
<span class="n">par</span> <span class="o">=</span> <span class="n">Parameterization</span><span class="p">(</span><span class="s1">&#39;default_orca&#39;</span><span class="p">)</span>

<span class="c1">#Add the model - this variable is what we are going to use to call our functions later, so pick one that is simple and easy to remember</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">COSMORS</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="let-s-start-with-the-first-calculations-using-opencosmo">
<h2>2.4 Let‚Äôs start with the first calculations using openCOSMO üß™<a class="headerlink" href="#let-s-start-with-the-first-calculations-using-opencosmo" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Use the function calculate_contact_statistics_molecule_properties from the cosmo-rs code</span>
<span class="n">model</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">calculate_contact_statistics_molecule_properties</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># OptionalüëÄ but we can save as txt file the parameterization details to see</span>
<span class="n">txt_par</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;par.txt&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">txt_par</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">txt_file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">par</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1">#print(model.par)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, clear all previous jobs and molecules (since this is our first time using the model, this step is not necessary)</span>
<span class="n">model</span><span class="o">.</span><span class="n">clear_jobs</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">clear_molecules</span><span class="p">()</span>

<span class="c1">#Add the new molecules to the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">butane_input</span><span class="p">])</span> <span class="c1">#molecule number 1</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">water_input</span><span class="p">])</span> <span class="c1">#molecule number 2</span>


<span class="c1">#Add the mole fractions</span>
<span class="c1">#This is the mole fraction array for the mixture we are analyzing, the first number corresponds to butane and the second one to water</span>
<span class="n">mole_fractions</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> 

<span class="c1">#set the temperature in K</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">298.15</span>
</pre></div>
</div>
</div>
</div>
<div style="line-height: 1.5;">
<p>Now we can perform the job, the formula for it is: <br></p>
<p><strong>model.add_job(mole_fractions, temperature, refst)</strong>
<br></p>
<p>The <strong>refst</strong> is the reference state. This property is used to calculate the chemical potential, which describes the difference between the mixture and the reference state. Remember that the formula for the potential energy is:</p>
<p><span class="math notranslate nohighlight">\(E=mgh\)</span>.</p>
<p>We can think of the <span class="math notranslate nohighlight">\(h\)</span> as our starting point, i.e. the refst.</p>
<a class="reference internal image-reference" href="../../_images/refst.png"><img alt="reference_state" src="../../_images/refst.png" style="width: 550px;" />
</a>
<ol class="arabic simple">
<li><p><strong><span style="color:#FF6347;">‚Äôpure component‚Äô</span></strong>: use it when we want to understand the behavior of each component relative to its <em>pure state</em>. Useful for calculating properties like infinite dilution activity coefficients or comparing mixture behavior to pure substances</p></li>
<li><p><strong><span style="color:#1E90FF;">‚Äôreference_mixture‚Äô</span></strong>: use it when we have a specific mixture to study the deviations from it</p></li>
<li><p><strong><span style="color:#32CD32;">‚ÄôCOSMO‚Äô</span></strong>: use it when we want to calculate properties ‚Äúwithout‚Äù reference state. This state is used to calculate solvation energies</p></li>
</ol>
<div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#add the job as &#39;pure_component&#39;</span>
<span class="n">refst</span><span class="o">=</span><span class="s2">&quot;pure_component&quot;</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">mole_fractions</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="p">)</span>

<span class="c1"># Perform calculations</span>
<span class="n">results_PC</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total logarithmic activity coefficient using pure_component: &#39;</span><span class="p">,</span> <span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual logarithmic activity coefficient using pure_component: &#39;</span><span class="p">,</span> <span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;enth&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Combinatorial logarithmic activity coefficient using pure_component:&#39;</span><span class="p">,</span> <span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;comb&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>


<span class="c1">#OptionalüëÄ Save the results as a txt file</span>
<span class="n">cosmors_results_output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s1">&#39;cosmors_results_water_butane.txt&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">cosmors_results_output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">txt_file</span><span class="p">:</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;COSMORS Results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;================</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Mole fractions</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Mole Fractions (x):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Temperature</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Temperature (T):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Total Results</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Total Results (tot):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Enthalpic Results</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Enthalpic Results (enth):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;enth&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Combinatorial Results</span>
    <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Combinatorial Results (comb):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results_PC</span><span class="p">[</span><span class="s1">&#39;comb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">txt_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total logarithmic activity coefficient using pure_component:  [[9.51405683 0.        ]]
Residual logarithmic activity coefficient using pure_component:  [[10.2943666  0.       ]]
Combinatorial logarithmic activity coefficient using pure_component: [[-0.78030977  0.        ]]
</pre></div>
</div>
</div>
</div>
<div style="line-height: 1.5;">
<p>Since we used <strong><span style="color:#FF6347;">‚Äôpure component‚Äô</span></strong> as a reference state and the mol fractions are [0,1] means that the Total logarithmic activity coefficient is actually the <strong><span style="color:#FF69B4;">Infinite dilution activity coefficient</span></strong> of butane in water at the given temperature.</p>
<div><p>Let‚Äôs try with <strong><span style="color:#1E90FF;">‚Äôreference_mixture‚Äô</span></strong> and <strong><span style="color:#32CD32;">‚ÄôCOSMO‚Äô</span></strong> as reference state:</p>
<p>In this second example we are using  <strong><span style="color:#1E90FF;">‚Äôreference_mixture‚Äô</span></strong> as refst. For the first component we are calculating <span class="math notranslate nohighlight">\(\gamma^\infty.\)</span> for the refst is at <strong>0</strong>, i.e. infinitely diluted. For the second component we are calculating <span class="math notranslate nohighlight">\(\gamma\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">clear_jobs</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">clear_molecules</span><span class="p">()</span>

<span class="c1"># add the job as &#39;reference_mixture&#39;</span>
<span class="n">refst</span><span class="o">=</span><span class="s2">&quot;reference_mixture&quot;</span>

<span class="c1">#add molecules:</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">butane_input</span><span class="p">])</span> <span class="c1">#molecule number 1</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">water_input</span><span class="p">])</span> <span class="c1">#molecule number 2</span>


<span class="n">mole_fractions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span> 

<span class="c1">#This is the mole fraction array for the reference mixture AGAINST which we want to compare the job mixture. </span>
<span class="c1">#if we put the same fractions for the x_refst and the mole_fractions, the result will be zero </span>
<span class="c1"># - as we are comparing with the same reference state)</span>
<span class="n">x_refst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> 

<span class="n">model</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">mole_fractions</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="p">,</span> <span class="n">x_refst</span><span class="p">)</span>


<span class="c1"># Perform calculations</span>
<span class="n">results_RM</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>

<span class="c1">#Print the results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total logarithmic activity coefficient using reference_mixture: &#39;</span><span class="p">,</span> <span class="n">results_RM</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual logarithmic activity coefficient using reference_mixture: &#39;</span><span class="p">,</span> <span class="n">results_RM</span><span class="p">[</span><span class="s1">&#39;enth&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Combinatorial logarithmic activity coefficient using reference_mixture:&#39;</span><span class="p">,</span> <span class="n">results_RM</span><span class="p">[</span><span class="s1">&#39;comb&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total logarithmic activity coefficient using reference_mixture:  [[-7.59754472  1.26694203]]
Residual logarithmic activity coefficient using reference_mixture:  [[-8.23178225  1.39386894]]
Combinatorial logarithmic activity coefficient using reference_mixture: [[ 0.63423753 -0.12692691]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">clear_jobs</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">clear_molecules</span><span class="p">()</span>

<span class="c1">#add the job as &#39;COSMO&#39;</span>
<span class="n">refst</span><span class="o">=</span><span class="s1">&#39;cosmo&#39;</span>

<span class="c1">#add molecules, this time with pentane</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">pentane_input</span><span class="p">])</span> <span class="c1">#molecule number 1</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">water_input</span><span class="p">])</span> <span class="c1">#molecule number 2</span>

<span class="n">model</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">mole_fractions</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="p">)</span>
<span class="c1"># Perform calculations</span>
<span class="n">results_CO</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total logarithmic activity coefficient using cosmo: &#39;</span><span class="p">,</span> <span class="n">results_CO</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual logarithmic activity coefficient using cosmo: &#39;</span><span class="p">,</span> <span class="n">results_CO</span><span class="p">[</span><span class="s1">&#39;enth&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Combinatorial logarithmic activity coefficient using cosmo:&#39;</span><span class="p">,</span> <span class="n">results_CO</span><span class="p">[</span><span class="s1">&#39;comb&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total logarithmic activity coefficient using cosmo:  [[11.49643925 -2.32538188]]
Residual logarithmic activity coefficient using cosmo:  [[12.62503979 -2.32538188]]
Combinatorial logarithmic activity coefficient using cosmo: [[-1.12860054  0.        ]]
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiple-calculations">
<h2>Multiple calculations:<a class="headerlink" href="#multiple-calculations" title="Link to this heading">#</a></h2>
<div style="line-height: 1.5;">
<p>If we have more molecules that we want to calculate the <span class="math notranslate nohighlight">\(\gamma^\infty.\)</span>, we include them all in the array. What the code does is a single calculation for the whole mixture, and then calculates the <span class="math notranslate nohighlight">\(\gamma^\infty\)</span> for each single component in our array. For 4 components plus our solvent it would look something like the image below, performing 6 calculations in total</p>
<p><img alt="multiple" src="../../_images/mulitple_calc.png" /></p>
<p><br><br><br></p>
<p>It is computationally more effective than to do a <em>for loop</em> because we would have to perform additional calculations:</p>
<p><br><br></p>
<p><img alt="forloop" src="../../_images/forloop.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#example with the molecules of butane, cyclopentane, benzene and toluene in water, lets add the remaining ones:</span>
<span class="n">cp_input</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;orcacosmo_files\cyclopentane_c000.orcacosmo&quot;</span>
<span class="n">bz_input</span> <span class="o">=</span>  <span class="sa">r</span><span class="s2">&quot;orcacosmo_files\benzene_c000.orcacosmo&quot;</span>
<span class="n">tol_input</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;orcacosmo_files\toluene_c000.orcacosmo&quot;</span>


<span class="n">model</span><span class="o">.</span><span class="n">clear_molecules</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">clear_jobs</span><span class="p">()</span>


<span class="c1">#Add the new molecules to the model</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">butane_input</span><span class="p">])</span> <span class="c1">#molecule number 1</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">cp_input</span><span class="p">])</span> <span class="c1">#molecule number 2</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">bz_input</span><span class="p">])</span> <span class="c1">#3</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">tol_input</span><span class="p">])</span> <span class="c1">#4</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">water_input</span><span class="p">])</span> <span class="c1">#5</span>


<span class="c1">#Add the mole fractions</span>
<span class="n">mole_fractions</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> 

<span class="c1">#set the temperature in K</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">298.15</span>

<span class="c1">#refst and call model</span>
<span class="n">refst</span><span class="o">=</span><span class="s1">&#39;pure_component&#39;</span>
<span class="n">model</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">mole_fractions</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="p">)</span>

<span class="n">results_multiple</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total logarithmic activity coefficient using cosmo: &#39;</span><span class="p">,</span> <span class="n">results_multiple</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total logarithmic activity coefficient using cosmo:  [[9.51405683 9.72489802 7.87271231 9.41188882 0.        ]]
</pre></div>
</div>
</div>
</div>
<div style="line-height: 1.5;">
<p>We have in total <strong>5</strong> <span class="math notranslate nohighlight">\(\gamma^\infty.\)</span></p>
<ul class="simple">
<li><p>If we were to perform only butane and water: <br></p>
<ul>
<li><p>Total logarithmic activity coefficient using cosmo:  <strong>[[9.51404423 , 0.]]</strong></p></li>
</ul>
</li>
<li><p>With butane, cyclopentane, benzene, toluene and water: <br></p>
<ul>
<li><p>Total logarithmic activity coefficient using cosmo:  <strong>[[9.51404423 , 9.72489802 , 7.87271231 , 9.41188882 , 0. ]]</strong>
<br></p></li>
</ul>
</li>
</ul>
<div></section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="plotting">
<h1>2.5 Plotting üìà<a class="headerlink" href="#plotting" title="Link to this heading">#</a></h1>
<p>The <strong>cosmo_visualizations.py</strong> in the src folder contains various functions that helps us vizualize the ‚ÄúœÉ-profile‚Äù of our molecule.</p>
<p>For the <strong><span style="color:#32CD32;">plot_sigma_profiles</span></strong> functions, we can use multiple files as input to plot them in the same graph and compare them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#for our water molecule:</span>
<span class="n">plot_sigma_profiles</span><span class="p">(</span>
    <span class="n">filepath_lst</span><span class="o">=</span><span class="p">[</span><span class="n">water_input</span><span class="p">,</span> <span class="n">butane_input</span><span class="p">,</span> <span class="n">pentane_input</span><span class="p">],</span>
    <span class="n">plot_name</span><span class="o">=</span><span class="s1">&#39;my_sigma_plot&#39;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span>
    <span class="n">dir_plot</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
    <span class="n">aggregate_plots</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># Use the correct parameter name</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1fd582ea7cacdc43841da55a6d0339368a80b31f65fffeaa24cf1a09ec731fa9.png" src="../../_images/1fd582ea7cacdc43841da55a6d0339368a80b31f65fffeaa24cf1a09ec731fa9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_3D_segment_location</span><span class="p">(</span><span class="n">water_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="sigma-profiles-using-plotly">
<h2>2.5.1 Sigma profiles using plotly<a class="headerlink" href="#sigma-profiles-using-plotly" title="Link to this heading">#</a></h2>
<p>For the following functions a <strong>pop-up window</strong> will appear with the graph and several <em>‚Äúextsp_molecule name‚Äù</em> files will be saved in our output folder we specified:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#this function will open up a </span>
<span class="n">plot_sigma_profiles_plotly</span><span class="p">(</span><span class="n">filepath_lst</span><span class="o">=</span><span class="p">[</span><span class="n">water_input</span><span class="p">])</span> <span class="c1">#you can add more than one orcacosmo file in here with ,</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_extended_sigma_profile_plotly</span><span class="p">(</span><span class="n">butane_input</span><span class="p">)</span>
<span class="n">plot_extended_sigma_profile_plotly</span><span class="p">(</span><span class="n">tol_input</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="further-examples">
<h1>2.6 Further examples:<a class="headerlink" href="#further-examples" title="Link to this heading">#</a></h1>
<p>For these examples, we need to change to the openCOSMO-RS directory, change the address to where your openCOSMO-RS_py is installed</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;../../..&quot;</span><span class="p">)</span>
<span class="n">new_directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;openCOSMO-RS_py\examples&#39;</span>

<span class="c1"># Change the current working directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">new_directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Using the new openCOSMO-RS 24a parameter set:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">crs</span> <span class="o">=</span> <span class="n">COSMORS</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="n">openCOSMORS24a</span><span class="p">())</span>

<span class="n">crs</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="s1">&#39;./../tests/COSMO_ORCA/ethanol.orcacosmo&#39;</span><span class="p">])</span>
<span class="n">crs</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="s1">&#39;./../tests/COSMO_ORCA/water.orcacosmo&#39;</span><span class="p">])</span>

<span class="c1"># infinite dilution activity coefficient of ethanol in water at 25 C</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">298</span>
<span class="n">crs</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="o">=</span><span class="s1">&#39;pure_component&#39;</span><span class="p">)</span>

<span class="c1"># infinite dilution activity coefficient of ethanol in water at 45 C</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">318</span>
<span class="n">crs</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="o">=</span><span class="s1">&#39;pure_component&#39;</span><span class="p">)</span>

<span class="c1"># 50:50 mole fraction based mixture of ethanol and water</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">])</span>
<span class="n">T</span> <span class="o">=</span> <span class="mf">298.15</span>
<span class="n">crs</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="o">=</span><span class="s1">&#39;pure_component&#39;</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">crs</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total logarithmic activity coefficient: &#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual logarithmic activity coefficient: &#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;enth&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Combinatorial logarithmic activity coefficient:&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;comb&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">])</span>

<span class="n">sigma_profile_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">sigma_profile_moments</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">molecule</span> <span class="ow">in</span> <span class="n">crs</span><span class="o">.</span><span class="n">enth</span><span class="o">.</span><span class="n">mol_lst</span><span class="p">:</span>
    <span class="n">molecule_filepath</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">cosmo_struct_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filepath</span>
    <span class="n">molecule_name</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">cosmo_struct_lst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.orcacosmo&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">spp</span> <span class="o">=</span> <span class="n">SigmaProfileParser</span><span class="p">(</span><span class="n">molecule_filepath</span><span class="p">)</span>
    <span class="n">sigmas</span><span class="p">,</span> <span class="n">areas</span> <span class="o">=</span> <span class="n">spp</span><span class="o">.</span><span class="n">cluster_and_create_sigma_profile</span><span class="p">()</span>
    <span class="n">sigma_profile_data</span><span class="p">[</span><span class="n">molecule_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Sigma&#39;</span><span class="p">:</span> <span class="n">sigmas</span><span class="p">,</span> <span class="s1">&#39;Area&#39;</span><span class="p">:</span> <span class="n">areas</span><span class="p">}</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">molecule_name</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sigmas</span><span class="p">,</span> <span class="n">areas</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">spp</span><span class="o">.</span><span class="n">calculate_sigma_moments</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Descriptors for </span><span class="si">{</span><span class="n">molecule_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">property_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;energy_dielectric&#39;</span><span class="p">,</span> <span class="s1">&#39;dipole_moment&#39;</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_moments&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">property_name</span><span class="p">,</span> <span class="n">spp</span><span class="p">[</span><span class="n">property_name</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sigma_hydrogen_bond_donor_moments&#39;</span><span class="p">,</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;sigma_hydrogen_bond_donor_moments&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sigma_hydrogen_bond_acceptor_moments&#39;</span><span class="p">,</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;sigma_hydrogen_bond_acceptor_moments&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>

    
    <span class="n">sigma_profile_moments</span><span class="p">[</span><span class="n">molecule_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sigma_moments&#39;</span><span class="p">:</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;sigma_moments&#39;</span><span class="p">],</span> <span class="s1">&#39;hb_donor_moment&#39;</span><span class="p">:</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;sigma_hydrogen_bond_donor_moments&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;hb_acceptor_moment&#39;</span><span class="p">:</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;sigma_hydrogen_bond_acceptor_moments&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------------------------------------&#39;</span><span class="p">)</span>


<span class="c1"># output to excel</span>
<span class="n">results_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">results_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">n_molecules</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">crs</span><span class="o">.</span><span class="n">enth</span><span class="o">.</span><span class="n">mol_lst</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i_molecule</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_molecules</span><span class="p">):</span>    
    <span class="n">results_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Concentration_</span><span class="si">{</span><span class="n">i_molecule</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">results_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ln_Gamma_total_</span><span class="si">{</span><span class="n">i_molecule</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i_job</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])):</span>
    <span class="n">results_data</span><span class="p">[</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;T&#39;</span><span class="p">][</span><span class="n">i_job</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i_molecule</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_molecules</span><span class="p">):</span>
        <span class="n">results_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Concentration_</span><span class="si">{</span><span class="n">i_molecule</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">i_job</span><span class="p">][</span><span class="n">i_molecule</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i_molecule</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_molecules</span><span class="p">):</span>
        <span class="n">results_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;ln_Gamma_total_</span><span class="si">{</span><span class="n">i_molecule</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">][</span><span class="n">i_job</span><span class="p">][</span><span class="n">i_molecule</span><span class="p">])</span>

<span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="s1">&#39;cosmors_results.xlsx&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
    <span class="c1"># First sheet: Sigma profiles</span>
    <span class="n">sigma_profiles_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">sigma_profile_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_Sigma&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sigma&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_Area&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Area&#39;</span><span class="p">]})</span>
        <span class="n">sigma_profiles_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sigma_profiles_df</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sigma_profiles_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Sigma Profiles&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Second sheet: Sigma moments</span>
    <span class="n">sigma_moments_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Molecule&#39;</span><span class="p">:</span> <span class="p">[],</span> 
                          <span class="s1">&#39;Sigma Moment 0&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Sigma Moment 1&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Sigma Moment 2&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;Sigma Moment 3&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Sigma Moment 4&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Sigma Moment 5&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;Sigma Moment 6&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;HB Donor Moment 2&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;HB Donor Moment 3&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;HB Donor Moment 4&#39;</span><span class="p">:</span> <span class="p">[],</span>
                          <span class="s1">&#39;HB Acceptor Moment 2&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;HB Acceptor Moment 3&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;HB Acceptor Moment 4&#39;</span><span class="p">:</span> <span class="p">[]}</span>
    
    
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">moments</span> <span class="ow">in</span> <span class="n">sigma_profile_moments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">sigma_moments_data</span><span class="p">[</span><span class="s1">&#39;Molecule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="p">[</span><span class="n">sigma_moments_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;Sigma Moment </span><span class="si">{</span><span class="n">i_moment</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moments</span><span class="p">[</span><span class="s1">&#39;sigma_moments&#39;</span><span class="p">][</span><span class="n">i_moment</span><span class="p">])</span> <span class="k">for</span> <span class="n">i_moment</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
        <span class="p">[</span><span class="n">sigma_moments_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;HB Donor Moment </span><span class="si">{</span><span class="n">i_moment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moments</span><span class="p">[</span><span class="s1">&#39;hb_donor_moment&#39;</span><span class="p">][</span><span class="n">i_moment</span><span class="p">])</span> <span class="k">for</span> <span class="n">i_moment</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="p">[</span><span class="n">sigma_moments_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;HB Acceptor Moment </span><span class="si">{</span><span class="n">i_moment</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moments</span><span class="p">[</span><span class="s1">&#39;hb_acceptor_moment&#39;</span><span class="p">][</span><span class="n">i_moment</span><span class="p">])</span> <span class="k">for</span> <span class="n">i_moment</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

    <span class="n">sigma_moments_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sigma_moments_data</span><span class="p">)</span>
    <span class="n">sigma_moments_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Sigma Moments&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Third sheet: Calculation results</span>
    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_data</span><span class="p">)</span>
    <span class="n">results_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Results&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total logarithmic activity coefficient:  [[2.2587486  0.        ]
 [2.24015471 0.        ]
 [0.16659988 0.44666041]] 

Residual logarithmic activity coefficient:  [[2.57913503 0.        ]
 [2.56054114 0.        ]
 [0.21602009 0.52331749]]
Combinatorial logarithmic activity coefficient: [[-0.32038643  0.        ]
 [-0.32038643  0.        ]
 [-0.04942021 -0.07665708]]
</pre></div>
</div>
<img alt="../../_images/24ccc01fffe89ff86fd02006b382d14a1300585355070438ca7219ab7a4e0637.png" src="../../_images/24ccc01fffe89ff86fd02006b382d14a1300585355070438ca7219ab7a4e0637.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Descriptors for ethanol
energy_dielectric -25.10678663745665
dipole_moment [-0.047311 -2.168231 -0.003471]
area 89.54018440890813
volume 68.36642744911612
sigma_moments [ 8.95401844e+01 -3.52331248e-04  4.47498246e+01  1.76274455e+01
  8.17963923e+01  4.88916504e+01  1.85772219e+02]
sigma_hydrogen_bond_donor_moments [2.30820891 1.18997386 0.38293059]
sigma_hydrogen_bond_acceptor_moments [4.83881932 2.87393992 1.31282655]
-----------------------------------------------
</pre></div>
</div>
<img alt="../../_images/d161c785cc1736d87cd2b13a00d04a54c188e639573eb85e181ecb9447f5b06e.png" src="../../_images/d161c785cc1736d87cd2b13a00d04a54c188e639573eb85e181ecb9447f5b06e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Descriptors for water
energy_dielectric -32.88772262001589
dipole_moment [ 4.500000e-05 -2.302853e+00  0.000000e+00]
area 42.89774598167642
volume 25.365505135002042
sigma_moments [4.28977460e+01 7.93007980e-05 6.06141519e+01 3.87999923e+00
 1.20676657e+02 1.77642596e+01 2.67165157e+02]
sigma_hydrogen_bond_donor_moments [5.13359864 2.61757537 0.86837383]
sigma_hydrogen_bond_acceptor_moments [5.77724896 3.3268231  1.38458782]
-----------------------------------------------
</pre></div>
</div>
</div>
</div>
<p>This function calculates how well acetaminophen (paracetamol) dissolves in different solvents:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add molecules</span>
<span class="n">solute_file</span> <span class="o">=</span> <span class="s1">&#39;./../tests/COSMO_ORCA/acetaminophen.orcacosmo&#39;</span> <span class="c1"># Replace with actual solute file</span>
<span class="n">crs</span> <span class="o">=</span> <span class="n">COSMORS</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="s1">&#39;default_orca&#39;</span><span class="p">)</span>

<span class="c1"># Constants</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">8.314</span>  <span class="c1"># Gas constant, J/(mol¬∑K)</span>
<span class="n">delta_h_fusion</span> <span class="o">=</span> <span class="mf">27.1</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Fusion enthalpy of the solute (J/mol)</span>
<span class="n">t_fusion</span> <span class="o">=</span> <span class="mf">443.6</span> <span class="c1"># Fusion temperature of the solute (K)</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="mf">298.15</span>  <span class="c1"># Temperature for the solubility calculation (K)</span>

<span class="k">def</span> <span class="nf">calc_solubility</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">delta_h_fusion</span><span class="p">,</span> <span class="n">t_fusion</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">iterative</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">rhs</span> <span class="o">=</span> <span class="o">-</span><span class="n">delta_h_fusion</span> <span class="o">/</span> <span class="n">R</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">temperature</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">t_fusion</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_gamma</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">crs</span><span class="o">.</span><span class="n">clear_jobs</span><span class="p">()</span>
        <span class="n">crs</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">refst</span><span class="o">=</span><span class="s1">&#39;pure_component&#39;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">crs</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">iterative</span><span class="p">:</span>
        <span class="n">ln_gamma_inf</span> <span class="o">=</span> <span class="n">calculate_gamma</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]))</span> 
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">ln_gamma_inf</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">equilibrium_condition</span><span class="p">(</span><span class="n">x_guess</span><span class="p">):</span>
        <span class="n">x_guess</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-15</span><span class="p">,</span> <span class="n">x_guess</span><span class="p">)</span>
        <span class="n">x_guess</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_guess</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_guess</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x_guess</span><span class="p">])</span>
        <span class="n">ln_gamma</span> <span class="o">=</span> <span class="n">calculate_gamma</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ln_gamma</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_guess</span><span class="p">)</span> <span class="o">-</span> <span class="n">rhs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diff</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">equilibrium_condition</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">)</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-15</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="c1"># exp data from: https://doi.org/10.1021/je990124v</span>
<span class="n">exp_data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;water&#39;</span><span class="p">:</span> <span class="mf">0.002068248</span><span class="p">,</span>
    <span class="s1">&#39;ethanol&#39;</span><span class="p">:</span> <span class="mf">0.066236658</span><span class="p">,</span>
    <span class="s1">&#39;acetic_acid&#39;</span><span class="p">:</span> <span class="mf">0.031816953</span><span class="p">,</span>
    <span class="s1">&#39;cyclohexane&#39;</span><span class="p">:</span> <span class="s1">&#39;N/A&#39;</span>
<span class="p">}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Solubility of acetaminophen/paracetamol in&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">solvent_file</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;./../tests/COSMO_ORCA/water.orcacosmo&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;./../tests/COSMO_ORCA/ethanol.orcacosmo&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;./../tests/COSMO_ORCA/acetic_acid.orcacosmo&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;./../tests/COSMO_ORCA/cyclohexane.orcacosmo&#39;</span><span class="p">]:</span>
        
        <span class="n">solvent_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">solvent_file</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.orcacosmo&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">crs</span><span class="o">.</span><span class="n">clear_molecules</span><span class="p">()</span>
        <span class="n">crs</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">solute_file</span><span class="p">])</span>
        <span class="n">crs</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">solvent_file</span><span class="p">])</span>
        <span class="n">x_solubility_non_iterative</span> <span class="o">=</span> <span class="n">calc_solubility</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">delta_h_fusion</span><span class="p">,</span> <span class="n">t_fusion</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">iterative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">x_solubility_iterative</span> <span class="o">=</span> <span class="n">calc_solubility</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">delta_h_fusion</span><span class="p">,</span> <span class="n">t_fusion</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">iterative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">exp_val</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">exp_data</span><span class="p">[</span><span class="n">solvent_name</span><span class="p">]</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">exp_data</span><span class="p">[</span><span class="n">solvent_name</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;N/A&#39;</span> <span class="k">else</span> <span class="n">exp_data</span><span class="p">[</span><span class="n">solvent_name</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">solvent_name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;non-iter calc: </span><span class="si">{</span><span class="n">x_solubility_non_iterative</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;iter calc: </span><span class="si">{</span><span class="n">x_solubility_iterative</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;exp: </span><span class="si">{</span><span class="n">exp_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in solubility calculation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Potential reasons for failure:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Activity coefficients calculated by COSMO-RS could be unrealistic at extreme compositions.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. The thermodynamic parameters (e.g., delta_h_fusion or t_fusion) might be inaccurate.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Issues with the openCOSMO-RS input files or parameterization might affect calculations.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solubility of acetaminophen/paracetamol in
water           non-iter calc: 0.00068 iter calc: 0.00012 exp: 0.00207
ethanol         non-iter calc: 0.09563 iter calc: 0.06122 exp: 0.06624
acetic_acid     non-iter calc: 0.06210 iter calc: 0.04727 exp: 0.03182
cyclohexane     non-iter calc: 0.00000 iter calc: 0.00000 exp: N/A
</pre></div>
</div>
</div>
</div>
<p>To calculate the <strong>solvation free energy</strong> using the new parameterization:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solvent_file</span> <span class="o">=</span> <span class="s1">&#39;./../tests/COSMO_ORCA/benzene.orcacosmo&#39;</span>
<span class="n">solute_file</span> <span class="o">=</span> <span class="s1">&#39;./../tests/COSMO_ORCA/ethanol.orcacosmo&#39;</span>
<span class="n">solute_gas_file</span> <span class="o">=</span> <span class="s1">&#39;./../tests/COSMO_ORCA/ethanol.xyz&#39;</span>

<span class="n">crs</span> <span class="o">=</span> <span class="n">COSMORS</span><span class="p">(</span><span class="n">par</span><span class="o">=</span><span class="n">openCOSMORS24a</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">calculte_liquid_molar_volume_25C</span><span class="p">(</span><span class="n">spp</span><span class="p">):</span>
    <span class="n">spp</span><span class="o">.</span><span class="n">calculate_sigma_moments</span><span class="p">()</span>

    <span class="n">molecule_is_water</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">spp</span><span class="p">[</span><span class="s1">&#39;atm_elmnt&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">molecule_is_water</span><span class="p">:</span>
        <span class="n">molar_volume_at_25C</span> <span class="o">=</span> <span class="mf">18.06863632</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span>
        <span class="n">second_sigma_moment</span> <span class="o">=</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;sigma_moments&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">fourth_sigma_moment</span> <span class="o">=</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;sigma_moments&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">number_of_atoms</span> <span class="o">=</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;atm_nr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
        <span class="n">number_of_Si_atoms</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">elmnt</span> <span class="ow">in</span> <span class="n">spp</span><span class="p">[</span><span class="s1">&#39;atm_elmnt&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">elmnt</span> <span class="o">==</span> <span class="s1">&#39;Si&#39;</span><span class="p">])</span>

        <span class="n">molar_volume_at_25C</span> <span class="o">=</span> <span class="mf">0.9430785419976806</span> <span class="o">*</span> <span class="n">number_of_atoms</span> \
                <span class="o">+</span> <span class="mf">0.6977322963011842</span> <span class="o">*</span> <span class="n">area</span> \
                <span class="o">-</span> <span class="mf">0.3161763939689293</span> <span class="o">*</span> <span class="n">second_sigma_moment</span> \
                <span class="o">+</span> <span class="mf">0.032441059832647084</span> <span class="o">*</span> <span class="n">fourth_sigma_moment</span> \
                <span class="o">+</span> <span class="mf">8.113026329415828</span> <span class="o">*</span> <span class="n">number_of_Si_atoms</span> \
                <span class="o">-</span> <span class="mf">0.07066832029215675</span>
        
        <span class="c1"># [&#39;number_of_atoms&#39;, &#39;sigma_moment_0&#39;, &#39;sigma_moment_2&#39;, &#39;sigma_moment_4&#39;, &#39;Si&#39;]</span>
        <span class="c1"># R¬≤ = 0.9950179866321556</span>

    <span class="k">return</span> <span class="n">molar_volume_at_25C</span> <span class="o">/</span> <span class="mi">1_000_000</span> <span class="c1"># m¬≥/mol</span>

<span class="k">def</span> <span class="nf">read_gas_phase_energy</span><span class="p">(</span><span class="n">gas_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gas_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    
<span class="k">def</span> <span class="nf">calculate_number_of_atoms_in_ring</span><span class="p">(</span><span class="n">gas_file</span><span class="p">):</span>
    <span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromXYZFile</span><span class="p">(</span><span class="n">gas_file</span><span class="p">)</span>
    <span class="n">number_of_atoms_in_ring</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">IsInRing</span><span class="p">():</span>
            <span class="n">number_of_atoms_in_ring</span> <span class="o">=</span> <span class="n">number_of_atoms_in_ring</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">number_of_atoms_in_ring</span>

<span class="k">def</span> <span class="nf">calculate_dGsolvation</span><span class="p">(</span><span class="n">solute_file</span><span class="p">,</span> <span class="n">solute_gas_file</span><span class="p">,</span> <span class="n">solvent_file</span><span class="p">):</span>
    
    <span class="n">kJ_per_kcal</span> <span class="o">=</span> <span class="mf">4.184</span>  
    <span class="n">kJdivmol_per_hartree</span> <span class="o">=</span> <span class="mf">2625.499639479</span> <span class="c1"># (kJ/mol)/hartree</span>

    <span class="n">spp_solvent</span> <span class="o">=</span> <span class="n">SigmaProfileParser</span><span class="p">(</span><span class="n">solvent_file</span><span class="p">)</span>
    <span class="n">solvent_liquid_molar_volume_at_25C</span> <span class="o">=</span> <span class="n">calculte_liquid_molar_volume_25C</span><span class="p">(</span><span class="n">spp_solvent</span><span class="p">)</span>

    <span class="n">spp_solute</span> <span class="o">=</span> <span class="n">SigmaProfileParser</span><span class="p">(</span><span class="n">solute_file</span><span class="p">)</span>

    <span class="n">solute_E_gas</span> <span class="o">=</span> <span class="n">read_gas_phase_energy</span><span class="p">(</span><span class="n">solute_gas_file</span><span class="p">)</span> <span class="c1"># hartree/mol</span>
    <span class="n">solute_E_COSMO</span> <span class="o">=</span> <span class="n">spp_solute</span><span class="p">[</span><span class="s1">&#39;energy_tot&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">kJdivmol_per_hartree</span> <span class="c1"># hartree/mol</span>
    <span class="n">solute_E_diel</span> <span class="o">=</span> <span class="p">(</span><span class="n">solute_E_COSMO</span> <span class="o">-</span> <span class="n">solute_E_gas</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">kJdivmol_per_hartree</span><span class="o">/</span> <span class="n">kJ_per_kcal</span><span class="p">)</span> <span class="c1"># kcal/mol</span>

    <span class="n">solute_E_vdw</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">taus</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]):</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">crs</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tau_&#39;</span><span class="p">)}</span>

    <span class="n">atom_atomic_numbers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">periodic_table</span><span class="o">.</span><span class="n">GetAtomicNumber</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">spp_solute</span><span class="p">[</span><span class="s1">&#39;atm_elmnt&#39;</span><span class="p">]])</span>
    <span class="n">segment_atomic_numbers</span> <span class="o">=</span> <span class="n">atom_atomic_numbers</span><span class="p">[</span><span class="n">spp_solute</span><span class="p">[</span><span class="s1">&#39;seg_atm_nr&#39;</span><span class="p">]]</span>
    <span class="k">for</span> <span class="n">atomic_number</span><span class="p">,</span> <span class="n">area</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">segment_atomic_numbers</span><span class="p">,</span> <span class="n">spp_solute</span><span class="p">[</span><span class="s1">&#39;seg_area&#39;</span><span class="p">]):</span>
        <span class="n">solute_E_vdw</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">taus</span><span class="p">[</span><span class="n">atomic_number</span><span class="p">])</span> <span class="o">*</span> <span class="n">area</span>

    <span class="n">number_of_atoms_in_ring</span> <span class="o">=</span> <span class="n">calculate_number_of_atoms_in_ring</span><span class="p">(</span><span class="n">solute_gas_file</span><span class="p">)</span>
    <span class="n">E_ring_correction</span> <span class="o">=</span> <span class="n">number_of_atoms_in_ring</span> <span class="o">*</span> <span class="n">crs</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">omega_ring</span>

    <span class="n">T</span> <span class="o">=</span> <span class="mf">298.15</span> <span class="c1"># this model was developed for values at 25 C only</span>
    <span class="n">RT</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">R</span>  <span class="o">*</span> <span class="n">T</span> <span class="o">/</span><span class="p">(</span><span class="n">kJ_per_kcal</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># kcal/mol</span>

    <span class="c1"># openCOSMO-RS calculation</span>
    <span class="n">crs</span><span class="o">.</span><span class="n">clear_molecules</span><span class="p">()</span>
    <span class="n">crs</span><span class="o">.</span><span class="n">clear_jobs</span><span class="p">()</span>
    <span class="n">crs</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">solute_file</span><span class="p">])</span>
    <span class="n">crs</span><span class="o">.</span><span class="n">add_molecule</span><span class="p">([</span><span class="n">solvent_file</span><span class="p">])</span>
    <span class="n">crs</span><span class="o">.</span><span class="n">add_job</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">T</span><span class="p">,</span> <span class="n">refst</span><span class="o">=</span><span class="s1">&#39;cosmo&#39;</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">crs</span><span class="o">.</span><span class="n">calculate</span><span class="p">()</span>
    
    <span class="n">mu</span> <span class="o">=</span> <span class="n">RT</span> <span class="o">*</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;tot&#39;</span><span class="p">][</span><span class="s1">&#39;lng&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">reference_pressure</span> <span class="o">=</span> <span class="mi">101325</span> <span class="c1"># Pa = 1 atm</span>
    <span class="n">molar_volume_ideal_gas</span> <span class="o">=</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">R</span>  <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">reference_pressure</span> <span class="c1"># m¬≥/mol</span>

    <span class="n">reference_state_corrections</span> <span class="o">=</span> <span class="n">RT</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">molar_volume_ideal_gas</span> <span class="o">/</span> <span class="n">solvent_liquid_molar_volume_at_25C</span><span class="p">)</span> <span class="c1"># kcal/mol</span>
    <span class="n">solute_dG_solvation</span> <span class="o">=</span> <span class="n">solute_E_diel</span> <span class="o">+</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">solute_E_vdw</span> <span class="o">-</span> <span class="n">E_ring_correction</span> <span class="o">-</span> <span class="n">reference_state_corrections</span> <span class="o">-</span> <span class="n">crs</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">eta</span> <span class="c1"># kcal/mol</span>
    
    <span class="k">return</span> <span class="n">solute_dG_solvation</span>

<span class="n">dGsolvation</span> <span class="o">=</span> <span class="n">calculate_dGsolvation</span><span class="p">(</span><span class="n">solute_file</span><span class="p">,</span> <span class="n">solute_gas_file</span><span class="p">,</span> <span class="n">solvent_file</span><span class="p">)</span>
<span class="c1"># results might differe slightly from the version of the paper as</span>
<span class="c1"># the implementation in python is slightly different from the one in c++</span>
<span class="c1"># which was used in tha parameterization</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Solvation energy of ethanol in benzene in kcal/mol:&#39;</span><span class="p">,</span> <span class="n">dGsolvation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Solvation energy of ethanol in benzene in kcal/mol: -3.116283419034712
</pre></div>
</div>
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks\7"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="github_opencosmors.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">II. openCOSMO-RS</p>
      </div>
    </a>
    <a class="right-next"
       href="ResultsAnalysis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">3 Results Analysis üîç</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">2. First Examples üî¨</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-all-necessary-libraries">2.1 Import all necessary libraries  üìö</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-the-paths-to-our-orcacosmo-files-and-set-the-output-directory">2.2 Define the paths to our .orcacosmo files and set the output directory üìí</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-a-parameterization-and-call-the-model">2.3 Choose a parameterization and call the model ‚öôÔ∏è</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-start-with-the-first-calculations-using-opencosmo">2.4 Let‚Äôs start with the first calculations using openCOSMO üß™</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-calculations">Multiple calculations:</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting">2.5 Plotting üìà</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sigma-profiles-using-plotly">2.5.1 Sigma profiles using plotly</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#further-examples">2.6 Further examples:</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Priscilla Ensley, Simon M√ºller, Edgar Sanchez
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>